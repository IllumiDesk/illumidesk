---
- name: synchronize illumidesk directory to working directory
  synchronize:
    src: ../../../../src
    dest: "{{ working_dir }}"
    rsync_opts:
      - "--no-motd"
      - "--exclude=build*"
      - "--exclude=*.egg-info"
      - "--exclude=*.pyc"
      - "--exclude=__pycache__"

- name: create a zip archive of the illumidesk package
  archive:
    path: "{{ working_dir }}/src"
    dest: "{{ working_dir }}/illumidesk.zip"
    format: zip

- name: create lti 11 configuration file from template
  template:
    src: lti11-cartridge.xml.j2
    dest: "{{ working_dir }}/lti11-cartridge.xml"
  when: authentication_type == "lti11"

- name: install psycopg2
  apt:
    name: python3-psycopg2

- name: ensure NBgrader database created for current ORG-NAME
  community.general.postgresql_db:
    encoding: UTF-8
    state: present
    name: "{{ postgres_nb_dbname }}" # required. name of the database to add or remove
    login_user: "{{ postgres_nb_user }}"
    login_password: "{{ postgres_nb_password }}"
    login_host: "{{ postgres_nb_host }}"
